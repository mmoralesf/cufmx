/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

(function(){var e,t,i,n,s,o,r,a,u,l,c=this;"undefined"==typeof window?(e=require("underscore"),t=require("backbone"),"undefined"!=typeof exports&&(exports=module.exports=t)):(e=c._,t=c.Backbone),i=t.Model,n=t.Collection,s=i.prototype,o=n.prototype,u=/[\.\[\]]+/g,r="change add remove reset sort destroy".split(" "),l=["reset","sort"],t.Associations={VERSION:"0.5.0"},t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",a=t.AssociatedModel=t.Associations.AssociatedModel=i.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=s.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(t,i,n){var s;return e.isObject(t)||null==t?(s=t,n=i):(s={},s[t]=i),t=this._set(s,n),this._processPendingEvents(),t},_set:function(t,i){var n,s,o,r,l=this;if(!t)return this;for(n in t)if(s||(s={}),n.match(u)){var c=h(n);r=e.initial(c),c=c[c.length-1],r=this.get(r),r instanceof a&&(r=s[r.cid]||(s[r.cid]={model:r,data:{}}),r.data[c]=t[n])}else r=s[this.cid]||(s[this.cid]={model:this,data:{}}),r.data[n]=t[n];if(s)for(o in s)r=s[o],this._setAttr.call(r.model,r.data,i)||(l=!1);else l=this._setAttr.call(this,t,i);return l},_setAttr:function(i,o){var r;if(o||(o={}),o.unset)for(r in i)i[r]=void 0;return this.parents=this.parents||[],this.relations&&e.each(this.relations,function(s){var r,u,l,c,d=s.key,h=s.relatedModel,f=s.collectionType,g=s.map,m=this.attributes[d],v=m&&m.idAttribute;if(h&&e.isString(h)&&(h=p(h)),f&&e.isString(f)&&(f=p(f)),g&&e.isString(g)&&(g=p(g)),u=s.options?e.extend({},s.options,o):o,i[d]){if(r=e.result(i,d),r=g?g(r):r,s.type===t.Many){if(f&&!f.prototype instanceof n)throw Error("collectionType must inherit from Backbone.Collection");r instanceof n?l=r:m?(m._deferEvents=!0,m.set(r,o),l=m):(l=f?new f:this._createCollection(h),l.add(r,u))}else s.type===t.One&&h&&(r instanceof a?l=r:m&&m&&r[v]&&m.get(v)===r[v]?(m._deferEvents=!0,m._set(r,o),l=m):l=new h(r,u));(c=i[d]=l)&&!c._proxyCallback&&(c._proxyCallback=function(){return this._bubbleEvent.call(this,d,c,arguments)},c.on("all",c._proxyCallback,this))}i.hasOwnProperty(d)&&(s=i[d],h=this.attributes[d],s?(s.parents=s.parents||[],-1==e.indexOf(s.parents,this)&&s.parents.push(this)):h&&h.parents.length>0&&(h.parents=e.difference(h.parents,[this])))},this),s.set.call(this,i,o)},_bubbleEvent:function(t,i,s){var o,u=s[0].split(":"),c=u[0],d="nested-change"==s[0],p=s[1],f=s[2],g=-1,m=i._proxyCalls,v=-1!==e.indexOf(r,c);if(!d){if(e.size(u)>1&&(o=u[1]),-1!==e.indexOf(l,c)&&(f=p),i instanceof n&&v&&p){var w=h(o),y=e.initial(w);(u=i.find(function(e){if(p===e)return!0;if(!e)return!1;var t=e.get(y);return(t instanceof a||t instanceof n)&&p===t?!0:(t=e.get(w),(t instanceof a||t instanceof n)&&p===t||t instanceof n&&f&&f===t?!0:void 0)}))&&(g=i.indexOf(u))}return o=t+(-1===g||"change"!==c&&!o?"":"["+g+"]")+(o?"."+o:""),/\[\*\]/g.test(o)?this:(u=o.replace(/\[\d+\]/g,"[*]"),g=[],g.push.apply(g,s),g[0]=c+":"+o,m=i._proxyCalls=m||{},this._isEventAvailable.call(this,m,o)?this:(m[o]=!0,"change"===c&&(this._previousAttributes[t]=i._previousAttributes,this.changed[t]=i),this.trigger.apply(this,g),"change"===c&&this.get(o)!=s[2]&&this.trigger.apply(this,["nested-change",o,s[1]]),m&&o&&delete m[o],o!==u&&(g[0]=c+":"+u,this.trigger.apply(this,g)),this))}},_isEventAvailable:function(t,i){return e.find(t,function(e,t){return-1!==i.indexOf(t,i.length-t.length)})},_createCollection:function(t){var i=t;if(e.isString(i)&&(i=p(i)),!(i&&i.prototype instanceof a))throw Error("type must inherit from Backbone.AssociatedModel");return t=new n,t.model=i,t},_processPendingEvents:function(){this.visited||(this.visited=!0,this._deferEvents=!1,e.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],e.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents()},this),delete this.visited)},trigger:function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):s.trigger.apply(this,arguments)},toJSON:function(t){var i,n;return this.visited||(this.visited=!0,i=s.toJSON.apply(this,arguments),this.relations&&e.each(this.relations,function(s){var o=this.attributes[s.key];o&&(n=o.toJSON(t),i[s.key]=e.isArray(n)?e.compact(n):n)},this),delete this.visited),i},clone:function(){return new this.constructor(this.toJSON())},_getAttr:function(t){var i,s,o=this,t=h(t);if(!(e.size(t)<1)){for(s=0;s<t.length&&(i=t[s],o);s++)o=o instanceof n?isNaN(i)?void 0:o.at(i):o.attributes[i];return o}}});var d=/[^\.\[\]]+/g,h=function(t){return""===t?[""]:e.isString(t)?t.match(d):t||[]},p=function(t){return e.reduce(t.split("."),function(e,t){return e[t]},c)},f=function(t,i,n){var s;return e.find(t,function(t){return(s=e.find(t.relations,function(e){return t.get(e.key)===i},this))?!0:void 0},this),s&&s.map?s.map(n):n},g={};e.each(["set","remove","reset"],function(e){g[e]=n.prototype[e],o[e]=function(t,i){return this.model.prototype instanceof a&&this.parents&&(arguments[0]=f(this.parents,this,t)),g[e].apply(this,arguments)}}),g.trigger=o.trigger,o.trigger=function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):g.trigger.apply(this,arguments)},o._processPendingEvents=a.prototype._processPendingEvents}).call(this),define("backbone.associations",["backbone"],function(e){return function(){var t;return t||e.Backbone.Associations}}(this)),define("js/models/group",["backbone","underscore","underscore.string","gettext","backbone.associations"],function(e,t,i,n){"use strict";var s=e.AssociatedModel.extend({defaults:function(){return{name:"",version:1,order:null,usage:[]}},url:function(){var e=this.collection.parents[0];return e.urlRoot+"/"+encodeURIComponent(e.id)+"/"+encodeURIComponent(this.id)},reset:function(){this.set(this._originalAttributes,{parse:!0})},isEmpty:function(){return!this.get("name")},toJSON:function(){return{id:this.get("id"),name:this.get("name"),version:this.get("version"),usage:this.get("usage")}},validate:function(e){return i.trim(e.name)?void 0:{message:n("Group name is required"),attributes:{name:!0}}}});return s}),define("js/collections/group",["underscore","underscore.string","backbone","gettext","js/models/group"],function(e,t,i,n,s){"use strict";var o=i.Collection.extend({model:s,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:0},isEmpty:function(){return 0===this.length||this.every(function(e){return e.isEmpty()})},getNextDefaultGroupName:function(){var i=this.nextOrder(),s=e.pluck(this.toJSON(),"name"),o="";do o=t.sprintf(n("Group %s"),this.getGroupId(i)),i++;while(e.contains(s,o));return o},getGroupId:function(){var t,i=n("ABCDEFGHIJKLMNOPQRSTUVWXYZ").split(""),s=i.length;return t=function(t,i){return e.isNumber(t)&&i?{quotient:t/i,remainder:t%i}:null},function o(e){var n,r="",a=t(e,s);return a?(n=Math.floor(a.quotient)-1,s>n?n>-1&&(r+=i[n]):r+=o(n),r+i[a.remainder]):String(e)}}()});return o}),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,i,n,s){return $.post(""+t()+e,i,n,s)},e.getWithPrefix=function(e,i,n,s){return $.get(""+t()+e,i,n,s)},e.ajaxWithPrefix=function(e,i){return null!=i?$.ajax(""+t()+e,i):(i=e,i.url=""+t()+i.url,$.ajax(i))}}}}.call(this),define("coffee/src/ajax_prefix",function(){}),define("domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](l)}function t(){var t=c;u&&t.length&&(c=[],e(t))}function i(){u||(u=!0,r&&clearInterval(r),t())}function n(e){return u?e(l):c.push(e),n}var s,o,r,a="undefined"!=typeof window&&window.document,u=!a,l=a?document:null,c=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),o=document.createElement("div");try{s=null===window.frameElement}catch(d){}o.doScroll&&s&&window.external&&(r=setInterval(function(){try{o.doScroll(),i()}catch(e){}},30))}"complete"===document.readyState&&i()}return n.version="2.0.1",n.load=function(e,t,i,s){s.isBuild?i(null):n(i)},n}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!common/templates/components/system-feedback.underscore",[],function(){return'<div class="wrapper wrapper-<%= type %> wrapper-<%= type %>-<%= intent %>\n            <% if(obj.shown) { %>is-shown<% } else { %>is-hiding<% } %>\n            <% if(_.contains([\'help\', \'mini\'], intent)) { %>wrapper-<%= type %>-status<% } %>"\n     id="<%= type %>-<%= intent %>"\n     aria-hidden="<% if(obj.shown) { %>false<% } else { %>true<% } %>"\n     aria-labelledby="<%= type %>-<%= intent %>-title"\n     tabindex="-1"\n     <% if (obj.message) { %>aria-describedby="<%= type %>-<%= intent %>-description" <% } %>\n     <% if (obj.actions) { %>role="dialog"<% } %>\n  >\n  <div class="<%= type %> <%= intent %> <% if(obj.actions) { %>has-actions<% } %>">\n    <% if(obj.icon) { %>\n      <% var iconClass = {"warning": "warning", "confirmation": "check", "error": "warning", "announcement": "bullhorn", "step-required": "exclamation-circle", "help": "question", "mini": "cog"} %>\n      <span class="feedback-symbol fa fa-<%= iconClass[intent] %>" aria-hidden="true"></span>\n    <% } %>\n\n    <div class="copy">\n      <h2 class="title title-3" id="<%= type %>-<%= intent %>-title"><%- title %></h2>\n      <% if(obj.message) { %><p class="message" id="<%= type %>-<%= intent %>-description"><%- message %></p><% } %>\n    </div>\n\n    <% if(obj.actions) { %>\n    <nav class="nav-actions">\n      <ul>\n        <% if(actions.primary) { %>\n        <li class="nav-item">\n          <button class="action-primary <%= actions.primary.class %>"><%- actions.primary.text %></button>\n        </li>\n        <% } %>\n        <% if(actions.secondary) {\n             _.each(actions.secondary, function(secondary) { %>\n        <li class="nav-item">\n          <button class="action-secondary <%= secondary.class %>"><%- secondary.text %></button>\n        </li>\n        <%   });\n           } %>\n      </ul>\n    </nav>\n    <% } %>\n\n    <% if(obj.closeIcon) { %>\n    <a href="#" rel="view" class="action action-close action-<%= type %>-close">\n      <span class="icon fa fa-times-circle" aria-hidden="true"></span>\n      <span class="label">close <%= type %></span>\n    </a>\n    <% } %>\n  </div>\n</div>\n'}),function(e){"use strict";e("common/js/components/views/feedback",["jquery","underscore","underscore.string","backbone","edx-ui-toolkit/js/utils/html-utils","text!../../../../common/templates/components/system-feedback.underscore"],function(e,t,i,n,s,o){var r=["a[href]:not([tabindex='-1'])","area[href]:not([tabindex='-1'])","input:not([disabled]):not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","iframe:not([tabindex='-1'])","[tabindex]:not([tabindex='-1'])","[contentEditable=true]:not([tabindex='-1'])"],a=n.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0,outFocusElement:null},initialize:function(i){if(this.options=t.extend({},this.options,i),!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},inFocus:function(e){var t,i=e||".wrapper";return this.options.outFocusElement=this.options.outFocusElement||document.activeElement,this.$(i).first().focus(),t=this.$(r.join()),t.on("keydown",function(e){9===e.which&&e.shiftKey&&e.target===t.first()[0]?(e.preventDefault(),t.last().focus()):9!==e.which||e.shiftKey||e.target!==t.last()[0]||(e.preventDefault(),t.first().focus())}),this},outFocus:function(){return this.$(r.join()).off("keydown"),this.options.outFocusElement&&this.options.outFocusElement.focus(),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=a["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),s.setHtml(this.$el,s.template(o)(this.options)),a["active_"+this.options.type]=this,this},primaryClick:function(e){var t,i;t=this.options.actions,t&&(i=t.primary,i&&(i.preventDefault!==!1&&e.preventDefault(),i.click&&i.click.call(e.target,this,e)))},secondaryClick:function(e){var i,n,s,o;i=this.options.actions,i&&(n=i.secondary,n&&(o=0,e&&e.target&&(o=t.indexOf(this.$(".action-secondary"),e.target)),s=n[o],s.preventDefault!==!1&&e.preventDefault(),s.click&&s.click.call(e.target,this,e)))}});return a})}.call(this,define||RequireJS.define),function(e){"use strict";e("common/js/components/views/feedback_notification",["jquery","underscore","underscore.string","./feedback"],function(e,t,i,n){var s,o,r,a=n.extend({options:e.extend({},n.prototype.options,{type:"notification",closeIcon:!1})});return s=t.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var i;i=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[s(t)]=i}),r=a.Mini.prototype.options,r.minShown=1250,r.closeIcon=!1,a})}.call(this,define||RequireJS.define),function(e){"use strict";define("cms/js/main",["domReady","jquery","underscore.string","backbone","gettext","../../common/js/components/views/feedback_notification","jquery.cookie"],function(t,i,n,s,o,r){var a,u;return a=function(){return e.addAjaxPrefix(jQuery,function(){return i("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},window.CMS.URL=window.CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},_.extend(window.CMS,s.Events),s.emulateHTTP=!0,i.ajaxSetup({headers:{"X-CSRFToken":i.cookie("csrftoken")},dataType:"json",content:{script:!1}}),i(document).ajaxError(function(e,t,i){var n,s,a=o("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");if(i.notifyOnError!==!1)return s=t.getResponseHeader("content-type"),s&&s.indexOf("json")>-1&&t.responseText&&(a=JSON.parse(t.responseText).error),n=new r.Error({title:o("Studio's having trouble saving your work"),message:a}),console.log("Studio AJAX Error",{url:e.currentTarget.URL,response:t.responseText,status:t.status}),n.show()}),u=function(e,t,n,s){return i.isFunction(t)&&(n=t,t=void 0),i.ajax({url:e,type:s,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:n})},i.postJSON=function(e,t,i){return u(e,t,i,"POST")},i.patchJSON=function(e,t,i){return u(e,t,i,"PATCH")},t(function(){return window.onTouchBasedDevice()?i("body").addClass("touch-based-device"):void 0})},a(),a})}.call(this,AjaxPrefix),define("js/models/group_configuration",["backbone","underscore","gettext","js/models/group","js/collections/group","backbone.associations","cms/js/main"],function(e,t,i,n,s){"use strict";var o=e.AssociatedModel.extend({defaults:function(){return{name:"",scheme:"random",description:"",version:2,groups:new s([{name:i("Group A"),order:0},{name:i("Group B"),order:1}]),showGroups:!1,editing:!1,usage:[]}},relations:[{type:e.Many,key:"groups",relatedModel:n,collectionType:s}],initialize:function(e,t){return this.on("remove:groups",this.groupRemoved),this.canBeEmpty=t&&t.canBeEmpty,this.setOriginalAttributes(),this},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())},reset:function(){this.set(this._originalAttributes,{parse:!0,validate:!0})},isDirty:function(){return!t.isEqual(this._originalAttributes,this.parse(this.toJSON()))},isEmpty:function(){return!this.get("name")&&this.get("groups").isEmpty()},parse:function(e){var i=$.extend(!0,{},e);return t.each(i.groups,function(e,t){e.order=e.order||t}),i},toJSON:function(){return{id:this.get("id"),name:this.get("name"),scheme:this.get("scheme"),description:this.get("description"),version:this.get("version"),groups:this.get("groups").toJSON()}},validate:function(n){if(!n.name.trim())return{message:i("Group Configuration name is required."),attributes:{name:!0}};if(!this.canBeEmpty&&n.groups.length<1)return{message:i("There must be at least one group."),attributes:{groups:!0}};var s=new e.Collection,o=new e.Collection;if(n.groups.each(function(e){e.isValid()?s.add(e):o.add(e)}),!o.isEmpty())return{message:i("All groups must have a name."),attributes:{groups:o.toJSON()}};var r=s.map(function(e){return e.get("name")});return r.length!==t.uniq(r).length?{message:i("All groups must have a unique name."),attributes:{groups:s.toJSON()}}:void 0},groupRemoved:function(){this.setOriginalAttributes()}});return o}),define("js/collections/group_configuration",["backbone","js/models/group_configuration"],function(e,t){"use strict";var i=e.Collection.extend({model:t});return i}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var n=null;n="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),i(n)},i=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var i="wmode=transparent";if(-1!==t.indexOf("?")){var n=t.split("?");if(-1===n[1].search("wmode=transparent")){var s=n[1],o=n[0];e(this).attr("src",o+"?"+i+"&"+s)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+i)}}else e(this).attr("wmode","transparent")})},n=function(t){if(t){var n=null,s=document.createElement("div");e(s).html(t),n=e(s).find("iframe, embed"),n.length>0&&(i(n),t=e(s).html())}return t};return{iframeBinding:t,iframeBindingHtml:n}}),define("js/utils/templates",["jquery","underscore"],function(e,t){var i=function(i){var n="#"+i+"-tpl",s=e(n).text();return s||console.error("Failed to load "+i+" template"),t.template(s)};return{loadTemplate:i}}),function(e){"use strict";e("common/js/components/views/feedback_prompt",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(e,t,i,n){var s,o,r=n.extend({options:e.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),n.prototype.render.apply(this,arguments)},show:function(){return n.prototype.show.apply(this,arguments),this.inFocus()},hide:function(){return n.prototype.hide.apply(this,arguments),this.outFocus()}});return s=t.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var i;i=r.extend({options:e.extend({},r.prototype.options,{intent:t})}),r[s(t)]=i}),r})}.call(this,define||RequireJS.define),function(e,t){"use strict";e("common/js/components/utils/view_utils",["jquery","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(e,i,n,s,o){var r,a,u,l,c,d,h,p,f,g,m,v,w,y,b,x,_,j,C,E=65;return r=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},a=function(){e(".ui-loading").show()},u=function(){e(".ui-loading").hide()},l=function(e,t,i,s,r){return new o.Warning({title:e,message:t,actions:{primary:{text:i,click:function(e){e.hide(),s()}},secondary:{text:n("Cancel"),click:function(e){return r&&r(),e.hide()}}}}).show()},c=function(e,t){var i;return i=new s.Mini({title:n(e)}),i.show(),t().done(function(){i.hide()})},d=function(t){return function(i){var n=this;h(e(i.currentTarget),function(){return n[t].apply(n,[i])})}},h=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},y=function(t){return function(i){i.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},g=function(t){e("html, body").animate({scrollTop:t},500)},p=function(t){var i=t.offset().top;return i-e(window).scrollTop()},f=function(e,t){var i=e.offset().top,n=i-t;g(n)},m=function(e){window.location=e},v=function(){window.location.reload()},w=function(e,t){var n,s=e.changedAttributes();if(!s)return!1;for(n=0;n<t.length;n++)if(i.has(s,t[n]))return!0;return!1},b=function(e){return 0===e.length?n("Required field."):""},x=function(e,t){var i=b(e);if(i)return i;if(t){if(/\s/g.test(e))return n("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},_=function(t){var n=i.reduce(t,function(t,i){return t+e(i).val().length},0);return E>=n},j=function(t,n,s,o){_(s)?e(t.errorWrapper).removeClass(n.shown).addClass(n.hiding):(e(t.errorWrapper).addClass(n.shown).removeClass(n.hiding),e(t.errorMessage).html("<p>"+i.template(o)({limit:E})+"</p>"),e(t.save).addClass(n.disabled))},C=function(i){var n=e.Deferred();return t([i],function(){n.resolve()},function(){n.reject()}),n.promise()},{toggleExpandCollapse:r,showLoadingIndicator:a,hideLoadingIndicator:u,confirmThenRunOperation:l,runOperationShowingMessage:c,withDisabledElement:d,disableElementWhileRunning:h,deleteNotificationHandler:y,setScrollTop:g,getScrollOffset:p,setScrollOffset:f,redirect:m,reload:v,hasChangedAttributes:w,validateRequiredField:b,validateURLItemEncoding:x,validateTotalKeyLength:_,checkTotalKeyLengthViolations:j,loadJavaScript:C}})}.call(this,define||RequireJS.define,require||RequireJS.require),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","common/js/components/utils/view_utils"],function(e,t,i,n,s,o,r){var a=i.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(e){t.bindAll(this,"beforeRender","render","afterRender"),this.options&&(e=t.extend({},t.result(this,"options"),e)),this.options=e;var n=this;this.render=t.wrap(this.render,function(e,t){return n.beforeRender(),e(t),n.afterRender(),n}),i.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){s.iframeBinding(this)},toggleExpandCollapse:function(t){var i=e(t.target);t.stopPropagation(),t.preventDefault(),r.toggleExpandCollapse(i,this.options.collapsedClass)},loadTemplate:function(e){return o.loadTemplate(e)}});return a}),define("js/views/pages/base_page",["jquery","js/views/baseview"],function(e,t){var i=t.extend({initialize:function(){t.prototype.initialize.call(this)},hasContent:function(){return!0},renderPage:function(){return e.Deferred().resolve().promise()},render:function(){var e=this;return this.$(".ui-loading").removeClass("is-hidden"),this.renderPage().done(function(){e.hasContent()||e.$(".no-content").removeClass("is-hidden")}).always(function(){e.$(".ui-loading").addClass("is-hidden")}),this}});return i}),define("js/views/list",["js/views/baseview"],function(e){"use strict";var t=e.extend({events:{"click .action-add":"onAddItem","click .new-button":"onAddItem"},listContainerCss:".list-items",initialize:function(){this.restrictEditing=this.options.restrictEditing||!1,this.listenTo(this.collection,"add",this.addNewItemView),this.listenTo(this.collection,"remove",this.onRemoveItem),this.template=this.loadTemplate("list"),this.listenTo(this.collection,"change:editing",this.toggleAddButton),this.listenTo(this.collection,"add",this.toggleAddButton),this.listenTo(this.collection,"remove",this.toggleAddButton)},render:function(e){return this.$el.html(this.template({itemCategoryDisplayName:this.itemCategoryDisplayName,newItemMessage:this.newItemMessage,emptyMessage:this.emptyMessage,length:this.collection.length,isEditing:e&&e.get("editing"),canCreateNewItem:this.canCreateItem(this.collection),restrictEditing:this.restrictEditing})),this.collection.each(function(e){this.$(this.listContainerCss).append(this.createItemView({model:e,restrictEditing:this.restrictEditing}).render().el)},this),this},hideOrShowAddButton:function(e){var t=".action-add";this.collection.length&&(e?this.$(t).removeClass("is-hidden"):this.$(t).addClass("is-hidden"))},toggleAddButton:function(e){e.get("editing")&&this.collection.contains(e)?this.hideOrShowAddButton(!1):this.hideOrShowAddButton(!0)},addNewItemView:function(e){var t=this.createItemView({model:e});this.collection.length>1?this.$(this.listContainerCss).append(t.render().el):this.render(),t.$el.focus()},canCreateItem:function(e){var t=!0;if(e.length>0){var i=e.maxAllowed;!_.isUndefined(i)&&e.length>=i&&(t=!1)}return t},onAddItem:function(e){e&&e.preventDefault&&e.preventDefault(),this.collection.add({editing:!0},this.newModelOptions)},onRemoveItem:function(){0===this.collection.length&&this.render()}});return t}),define("js/views/list_item",["js/views/baseview","jquery","gettext","common/js/components/utils/view_utils"],function(e,t,i,n){"use strict";var s=e.extend({canDelete:!1,initialize:function(){this.restrictEditing=this.options.restrictEditing||!1,this.listenTo(this.model,"change:editing",this.render),this.listenTo(this.model,"remove",this.remove)},className:function(){var e=this.model.collection.indexOf(this.model);return["wrapper-collection","wrapper-collection-"+e,this.baseClassName,this.baseClassName+"s-list-item",this.baseClassName+"s-list-item-"+e].join(" ")},deleteItem:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.canDelete){var t=this.model,s=this.itemDisplayName;n.confirmThenRunOperation(interpolate(i("Delete this %(item_display_name)s?"),{item_display_name:s},!0),interpolate(i("Deleting this %(item_display_name)s is permanent and cannot be undone."),{item_display_name:s},!0),i("Delete"),function(){return n.runOperationShowingMessage(i("Deleting"),function(){return t.destroy({wait:!0})})})}},render:function(){return this.view&&this.view.remove(),this.model.get("editing")?this.view=this.createEditView():this.view=this.createDetailsView(),this.$el.html(this.view.render().el),this}});return s}),define("js/views/group_configuration_details",["js/views/baseview","underscore","gettext","underscore.string","edx-ui-toolkit/js/utils/string-utils","edx-ui-toolkit/js/utils/html-utils"],function(e,t,i,n,s,o){"use strict";var r=e.extend({tagName:"div",events:{"click .edit":"editConfiguration","click .show-groups":"showGroups","click .hide-groups":"hideGroups"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection","group-configuration-details","group-configuration-details-"+e].join(" ")},initialize:function(){this.template=o.template($("#group-configuration-details-tpl").text()),this.listenTo(this.model,"change",this.render)},render:function(){var e=$.extend({},this.model.attributes,{groupsCountMessage:this.getGroupsCountTitle(),usageCountMessage:this.getUsageCountTitle(),courseOutlineUrl:this.model.collection.outlineUrl,index:this.model.collection.indexOf(this.model)});return o.setHtml(this.$el,this.template(e)),this},editConfiguration:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("editing",!0)},showGroups:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showGroups",!0)},hideGroups:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showGroups",!1)},getGroupsCountTitle:function(){var e=this.model.get("groups").length,t=ngettext("Contains {count} group","Contains {count} groups",e);return s.interpolate(t,{count:e})},getUsageCountTitle:function(){var e=this.model.get("usage").length;return 0===e?i("Not in Use"):s.interpolate(ngettext("Used in {count} unit","Used in {count} units",e),{count:e})}});return r}),define("js/views/list_item_editor",["js/views/baseview","common/js/components/utils/view_utils","underscore","gettext"],function(e,t,i,n){"use strict";var s=e.extend({initialize:function(){this.listenTo(this.model,"invalid",this.render),this.listenTo(this.getSaveableModel(),"invalid",this.render)},render:function(){this.$el.html(this.template(i.extend({error:this.model.validationError||this.getSaveableModel().validationError},this.getTemplateOptions())))},setAndClose:function(e){return e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()&&this.getSaveableModel().isValid()?void t.runOperationShowingMessage(n("Saving"),function(){var e=$.Deferred(),t=this.getSaveableModel();return t.save({},{success:function(){t.setOriginalAttributes(),this.close(),e.resolve()}.bind(this)}),e}.bind(this)):!1},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.getSaveableModel().reset(),this.close()},close:function(){return this.remove(),this.model.isNew()&&!i.isUndefined(this.model.collection)?this.model.collection.remove(this.model):this.model.set("editing",!1),this}});return s}),define("text!templates/group-edit.underscore",[],function(){return'<div class="input-wrap field long text required field-add-group-name group-<%- index %>-name\n    <% if (error && error.attributes && error.attributes.name) { print(\'error\'); } %>"><input name="group-<%- index %>-name" class="group-name long" value="<%- name %>" type="text">\n</div><div class="group-allocation"><%- allocation %>%</div>\n<a href="" class="action action-close"><span class="icon fa fa-times-circle" aria-hidden="true"></span> <span class="sr"><%- gettext("delete group") %></span></a>\n'}),define("js/views/experiment_group_edit",["js/views/baseview","underscore","underscore.string","gettext","text!templates/group-edit.underscore"],function(e,t,i,n,s){"use strict";var o=e.extend({tagName:"li",events:{"click .action-close":"removeGroup","change .group-name":"changeName","focus .group-name":"onFocus","blur .group-name":"onBlur"},className:function(){var e=this.model.collection.indexOf(this.model);return"field-group group group-"+e},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.collection,i=e.indexOf(this.model);return this.$el.html(t.template(s)({name:this.model.get("name"),allocation:this.getAllocation(),index:i,error:this.model.validationError})),this},changeName:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({name:this.$(".group-name").val()},{silent:!0}),this},removeGroup:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.collection.remove(this.model),this.remove()},getAllocation:function(){return Math.floor(100/this.model.collection.length)},onFocus:function(){this.$el.closest(".groups-fields").addClass("is-focused")},onBlur:function(){this.$el.closest(".groups-fields").removeClass("is-focused")}});return o}),define("js/views/group_configuration_editor",["js/views/list_item_editor","underscore","jquery","gettext","js/views/experiment_group_edit"],function(e,t,i,n,s){"use strict";var o=e.extend({tagName:"div",events:{"change .collection-name-input":"setName","change .group-configuration-description-input":"setDescription","click .action-add-group":"createGroup","focus .input-text":"onFocus","blur .input-text":"onBlur",
submit:"setAndClose","click .action-cancel":"cancel"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection-edit","group-configuration-edit","group-configuration-edit-"+e].join(" ")},initialize:function(){var t=this.model.get("groups");e.prototype.initialize.call(this),this.template=this.loadTemplate("group-configuration-editor"),this.listenTo(t,"add",this.onAddItem),this.listenTo(t,"reset",this.addAll),this.listenTo(t,"all",this.render)},render:function(){return e.prototype.render.call(this),this.addAll(),this},getTemplateOptions:function(){return{id:this.model.get("id"),uniqueId:t.uniqueId(),name:this.model.get("name"),description:this.model.get("description"),usage:this.model.get("usage"),isNew:this.model.isNew()}},getSaveableModel:function(){return this.model},onAddItem:function(e){var t=new s({model:e});return this.$("ol.groups").append(t.render().el),this},addAll:function(){this.model.get("groups").each(this.onAddItem,this)},createGroup:function(e){e&&e.preventDefault&&e.preventDefault();var t=this.model.get("groups");t.add([{name:t.getNextDefaultGroupName(),order:t.nextOrder()}])},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".collection-name-input").val(),{silent:!0})},setDescription:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("description",this.$(".group-configuration-description-input").val(),{silent:!0})},setValues:function(){return this.setName(),this.setDescription(),t.each(this.$(".groups li"),function(e,t){var n=this.model.get("groups").at(t);n&&n.set({name:i(".group-name",e).val()})},this),this}});return o}),define("js/views/group_configuration_item",["js/views/list_item","js/views/group_configuration_details","js/views/group_configuration_editor","gettext"],function(e,t,i,n){"use strict";var s=e.extend({events:{"click .delete":"deleteItem"},tagName:"section",baseClassName:"group-configuration",canDelete:!0,itemDisplayName:n("group configuration"),attributes:function(){return{id:this.model.get("id"),tabindex:-1}},createEditView:function(){return new i({model:this.model})},createDetailsView:function(){return new t({model:this.model})}});return s}),define("js/views/group_configurations_list",["js/views/list","js/views/group_configuration_item","gettext"],function(e,t,i){"use strict";var n=e.extend({tagName:"div",className:"group-configurations-list",newModelOptions:{addDefaultGroups:!0},itemCategoryDisplayName:i("group configuration"),newItemMessage:i("Add your first group configuration"),emptyMessage:i("You have not created any group configurations yet."),createItemView:function(e){return new t(e)}});return n}),define("js/views/content_group_editor",["js/views/list_item_editor","underscore"],function(e,t){"use strict";var i=e.extend({tagName:"div",className:"content-group-edit collection-edit",events:{submit:"setAndClose","click .action-cancel":"cancel"},initialize:function(){e.prototype.initialize.call(this),this.template=this.loadTemplate("content-group-editor")},getTemplateOptions:function(){return{id:this.model.get("id"),name:this.model.get("name"),index:this.model.collection.indexOf(this.model),isNew:this.model.isNew(),usage:this.model.get("usage"),uniqueId:t.uniqueId()}},setValues:function(){return this.model.set({name:this.$("input").val().trim()}),this},getSaveableModel:function(){return this.model.collection.parents[0]}});return i}),define("js/views/partition_group_details",["js/views/baseview","underscore","gettext","underscore.string","edx-ui-toolkit/js/utils/string-utils","edx-ui-toolkit/js/utils/html-utils"],function(e,t,i,n,s,o){"use strict";var r=e.extend({tagName:"div",events:{"click .edit":"editGroup","click .show-groups":"showContentGroupUsages","click .hide-groups":"hideContentGroupUsages"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection","partition-group-details","partition-group-details-"+e].join(" ")},editGroup:function(){this.model.set({editing:!0})},initialize:function(){this.template=this.loadTemplate("partition-group-details"),this.restrictEditing=this.options.restrictEditing||!1,this.listenTo(this.model,"change",this.render)},render:function(e){var t=$.extend({},this.model.attributes,{usageCountMessage:this.getUsageCountTitle(),courseOutlineUrl:this.model.collection.parents[0].outlineUrl,index:this.model.collection.indexOf(this.model),showContentGroupUsages:e||!1,HtmlUtils:o,restrictEditing:this.restrictEditing});return o.setHtml(this.$el,o.HTML(this.template(t))),this},showContentGroupUsages:function(e){e&&e.preventDefault&&e.preventDefault(),this.render(!0)},hideContentGroupUsages:function(e){e&&e.preventDefault&&e.preventDefault(),this.render(!1)},getUsageCountTitle:function(){var e=this.model.get("usage").length;return 0===e?i("Not in Use"):s.interpolate(ngettext("Used in {count} unit","Used in {count} units",e),{count:e})}});return r}),define("js/views/partition_group_item",["js/views/list_item","js/views/content_group_editor","js/views/partition_group_details","gettext","common/js/components/utils/view_utils"],function(e,t,i,n){"use strict";var s=e.extend({events:{"click .delete":"deleteItem"},tagName:"section",baseClassName:"partition-group",canDelete:!0,itemDisplayName:n("content group"),attributes:function(){return{id:this.model.get("id"),tabindex:-1}},createEditView:function(){return new t({model:this.model})},createDetailsView:function(){return new i({model:this.model,restrictEditing:this.options.restrictEditing})}});return s}),define("js/views/partition_group_list",["underscore","js/views/list","js/views/partition_group_item","gettext"],function(e,t,i,n){"use strict";var s=t.extend({initialize:function(e){t.prototype.initialize.apply(this,[e]),this.scheme=e.scheme},tagName:"div",className:"partition-group-list",itemCategoryDisplayName:n("content group"),newItemMessage:n("Add your first content group"),emptyMessage:n("You have not created any content groups yet."),createItemView:function(t){return new i(e.extend({},t,{scheme:this.scheme}))}});return s}),define("js/views/pages/group_configurations",["jquery","underscore","gettext","js/views/pages/base_page","js/views/group_configurations_list","js/views/partition_group_list"],function(e,t,i,n,s,o){"use strict";var r=n.extend({initialize:function(e){var t,i,r="enrollment_track";for(n.prototype.initialize.call(this),this.experimentsEnabled=e.experimentsEnabled,this.experimentsEnabled&&(this.experimentGroupConfigurations=e.experimentGroupConfigurations,this.experimentGroupsListView=new s({collection:this.experimentGroupConfigurations})),this.allGroupConfigurations=e.allGroupConfigurations||[],this.allGroupViewList=[],i=0;i<this.allGroupConfigurations.length;i++)t=this.allGroupConfigurations[i].get("scheme"),this.allGroupViewList.push(new o({collection:this.allGroupConfigurations[i].get("groups"),restrictEditing:t===r,scheme:t}))},renderPage:function(){var t,i,n=this.getLocationHash();for(this.experimentsEnabled&&this.$(".wrapper-groups.experiment-groups").append(this.experimentGroupsListView.render().el),t=0;t<this.allGroupViewList.length;t++)i=".wrapper-groups.content-groups."+this.allGroupViewList[t].scheme,this.$(i).append(this.allGroupViewList[t].render().el);return this.addWindowActions(),n&&this.expandConfiguration(n.replace("#","")),e.Deferred().resolve().promise()},addWindowActions:function(){e(window).on("beforeunload",this.onBeforeUnload.bind(this))},areAnyConfigurationsDirty:function(){var e;for(e=0;e<this.allGroupConfigurations.length;e++)if(this.allGroupConfigurations[e].isDirty())return!0;return!1},onBeforeUnload:function(){var e=this.areAnyConfigurationsDirty()||this.experimentsEnabled&&this.experimentGroupConfigurations.find(function(e){return e.isDirty()});return e?i("You have unsaved changes. Do you really want to leave this page?"):void 0},getLocationHash:function(){return window.location.hash},expandConfiguration:function(e){var t=this.experimentsEnabled&&this.experimentGroupConfigurations.findWhere({id:parseInt(e)});t&&(t.set("showGroups",!0),this.$("#"+e).focus())}});return r}),define("js/factories/group_configurations",["js/collections/group_configuration","js/models/group_configuration","js/views/pages/group_configurations"],function(e,t,i){"use strict";return function(n,s,o,r,a){var u,l,c=new e(s,{parse:!0}),d=[];for(l=0;l<o.length;l++)u=new t(o[l],{parse:!0,canBeEmpty:!0}),u.urlRoot=r,u.outlineUrl=a,d.push(u);c.url=r,c.outlineUrl=a,new i({el:$("#content"),experimentsEnabled:n,experimentGroupConfigurations:c,allGroupConfigurations:d}).render()}});